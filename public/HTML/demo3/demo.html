<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
		<style>
			body { margin: 0;  padding: 0; overflow: hidden;}
		</style>
	</head>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r72/three.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js"></script>
		<!-- <script type="text/javascript" src="../js/lib/OrbitControls.js"></script> -->
		<script>
			// Setting the scene

			var scene = new THREE.Scene();

			// Camera Object

			var camera = new THREE.PerspectiveCamera(4, window.innerWidth / window.innerHeight, 0.1, 1000);
			camera.position.z = 75;
			camera.position.x = 50;
			camera.position.y = 50;
			camera.lookAt(scene.position);
			camera.updateMatrixWorld();

			// Render Object

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

			// Making the cube

			var geometry = new THREE.BoxGeometry(5, 5, 5, 5, 5, 5);
			var material = new THREE.MeshDepthMaterial({
				opacity: 0.1,
				blending: THREE.NormalBlending, 
				depthTest: true,
				wireframe: true
			});
			

			var cube = new THREE.Mesh(geometry, material);

			scene.add(cube);
			cube.scale.x = 0.2;
			cube.scale.y = 0.2;
			cube.scale.z = 0.2;



			// Options to be added to the GUI

			var options = {
				velx: 0.01,
				vely: 0.01,
				_vx: 0,
				_vy: 0,
				camera: {
					speed: 0.0004,
					_speed: 0
				},
				stop: function() {
					this._vx = this.velx;
					this._vy = this.vely;
					this.camera._speed = this.camera.speed;
					this.camera.speed = 0;
					this.velx = 0;
					this.vely = 0;
				},
				play: function() {
					if (this.velx == 0 && this.vely == 0) {
						this.velx = this._vx;
						this.vely = this._vy;
						this.camera.speed = this.camera._speed;
					}
				},
				reset: function() {
					this.velx = 0.01;
					this.vely = 0.01;
					camera.position.z = 75;
					camera.position.x = 0;
					camera.position.y = 50;
					cube.scale.x = 0.2;
					cube.scale.y = 0.2;
					cube.scale.z = 0.2;
					cube.material.wireframe = true;
				}
			};

			// DAT.GUI Related Stuff

			var gui = new dat.GUI({width: 350});

			var cam = gui.addFolder('Camera');
			cam.add(options.camera, 'speed', 0, 0.0010).listen();
			cam.add(camera.position, 'y', 0, 100).listen();
			cam.open();

			var velocity = gui.addFolder('Velocity');
			velocity.add(options, 'velx', -0.2, 0.2).name('X').listen();
			velocity.add(options, 'vely', -0.2, 0.2).name('Y').listen();
			velocity.open();

			var box = gui.addFolder('Cube');
			box.add(cube.scale, 'x', 0, 3).name('Width').listen();
			box.add(cube.scale, 'y', 0, 3).name('Height').listen();
			box.add(cube.scale, 'z', 0, 3).name('Length').listen();
			box.add(cube.material, 'wireframe').listen();
			box.open();

			gui.add(options, 'stop');
			gui.add(options, 'play');
			gui.add(options, 'reset');

			// Rendering the animation   

			var render = function() {

			requestAnimationFrame(render);

			var timer = Date.now() * options.camera.speed;
			camera.position.x = Math.cos(timer) * 100;
			camera.position.z = Math.sin(timer) * 100;
			camera.lookAt(scene.position); 
			camera.updateMatrixWorld();

			cube.rotation.x += options.velx;
			cube.rotation.y += options.vely;

			renderer.render(scene, camera);

			};
			render();

			// 监听画面变化，更新渲染画面
			window.addEventListener("resize", () => {
				// console.log("画面变化了");
				// 更新摄像头
				camera.aspect = window.innerWidth / window.innerHeight;
				//   更新摄像机的投影矩阵
				camera.updateProjectionMatrix();

				//   更新渲染器
				renderer.setSize(window.innerWidth, window.innerHeight);
				//   设置渲染器的像素比
				renderer.setPixelRatio(window.devicePixelRatio);
			});

			window.addEventListener("dblclick", () => {
				const fullScreenElement = document.fullscreenElement;
				if (!fullScreenElement) {
					//   双击控制屏幕进入全屏，退出全屏
					// 让画布对象全屏
					renderer.domElement.requestFullscreen();
				} else {
					//   退出全屏，使用document对象
					document.exitFullscreen();
				}
				//   console.log(fullScreenElement);
			});

			var _cx = 0;
			var _cy = 0;
			var _vx = 0;
			var _vy = 0;
			// desktop
			var mouseDown = false;
			document.body.style.cursor = 'pointer';
			// 按下
			window.addEventListener('mousedown', function(e) {
				mouseDown = true;
				document.body.style.cursor = 'ew-resize';
				_cx = e.clientX;
				_cy = e.clientY;
				// options.stop();
			});
			// 松开
			window.addEventListener('mouseup', function(e) {
				mouseDown = false;
				document.body.style.cursor = 'pointer';
				// options.play();
			});
			// 移动
			window.addEventListener('mousemove', function(e) {
			if (mouseDown === true) {
				var cx = e.clientX;
				var cy = e.clientY;
				var dx = cx - _cx;
				var dy = cy - _cy;
				_cx = cx;
				_cy = cy;
				cube.rotation.x += dx/50;
				cube.rotation.y += dy/50;

				renderer.render(scene, camera);
			}
			});
			window.addEventListener('mousewheel', function(e) {
				console.log((e.deltaY)/100)
				console.log(cube.scale.x, cube.scale.y, cube.scale.z)

				if (e.deltaY > 0) {
					cube.scale.x += (e.deltaY)/4000
					cube.scale.y += (e.deltaY)/4000
					cube.scale.z += (e.deltaY)/4000
				} else if (e.deltaY < 0 &&
							cube.scale.x > 0.05 && 
							cube.scale.y > 0.05 &&
							cube.scale.z > 0.05) {
					cube.scale.x += (e.deltaY)/4000
					cube.scale.y += (e.deltaY)/4000
					cube.scale.z += (e.deltaY)/4000
				}
				renderer.render(scene, camera);
			})
			
			// mobile
			window.addEventListener('touchstart', function(e) {
				_cx = e.touches[0].clientX;
				_cy = e.touches[0].clientY;
				e.preventDefault();
			});
			window.addEventListener('touchend', function(e) {
				// resume();
				e.preventDefault();
			});
			window.addEventListener('touchmove', function(e) {
				var cx = e.touches[0].clientX;
				var cy = e.touches[0].clientY;
				var dx = cx - _cx;
				var dy = cy - _cy;
				_cx = cx;
				_cy = cy;
				cube.rotation.x += dx/50;
				cube.rotation.y += dy/50;

				renderer.render(scene, camera);
				
				e.preventDefault();
			});
		</script>
	</body>
</html>
